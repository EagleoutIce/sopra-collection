%% sopra-documentation.sty
%%
%% -----------------------------------------------------------------------------
%% Version: 1.0
%% Author:  Florian Sihler, 02.12.2019
%% 
%% Will contain all the definitions and packages to be used in the documentation
%% of all the other sopra-* packages

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sopra-documentation}[2019/12/02 EagleoutIce - documentation for the sopra-team-020]

%% -----------------------------------------------------------------------------
%% Lengths and Registers
%% -----------------------------------------------------------------------------

\newcounter{sodversion} \setcounter{sodversion}{1000}


\newif\ifsod@usedummy@
\newif\ifsod@uselistings@

%% -----------------------------------------------------------------------------
%% Package-Args
%% -----------------------------------------------------------------------------

% allow debug-options :D
\DeclareOption{debug}{ \errorcontextlines 99999 }%
\DeclareOption{nodebug}{ \errorcontextlines 4 }%

\DeclareOption{dummy}{ \sod@usedummy@true }%
\DeclareOption{nodummy}{ \sod@usedummy@false }%

\DeclareOption{listings}{ \sod@uselistings@true }%
\DeclareOption{nolistings}{ \sod@uselistings@false }%

\ExecuteOptions{nodebug,dummy,listings}% set it explicitly
\ProcessOptions\relax%

%% -----------------------------------------------------------------------------
%% Basic Packages
%% -----------------------------------------------------------------------------

\ifsod@usedummy@ \RequirePackage{blindtext} \fi % only for testing and stuff :D

\RequirePackage{attachfile2}% including files :D
\RequirePackage{multicol,xcolor}

\@ifundefined{thesobversion}{% not called from sopra-base-class
    \RequirePackage{hyperref}
}{}
\attachfilesetup{%
    author={Florian Sihler},
    color=0.6392 0.149 0.2314,
    icon=Tag,
    mimetype=text/plain
}

\def\email#1{\href{mailto:#1}{#1}}

\ifsod@uselistings@%
    \RequirePackage{LILLYxLISTINGS}
\else%
    \let\T\texttt% typewriter 'T'

    \def\lstcomment#1{\bgroup\ttfamily\color{gray}#1\egroup}
    \foreach \col/\sig in {purple/one,green/two,orange/three,teal/four,gray/five,black/six}{
        \expandafter\xdef\csname lstkw\sig\endcsname##1{\bgroup\noexpand\ttfamily\noexpand\color{\col}##1\egroup}
    }
    \def\lststring#1{\bgroup\ttfamily\color{orange!90!purple}#1\egroup}
    \def\lstnumber#1{\bgroup\ttfamily\itshape\color{blue}#1\egroup}
\fi

%% -----------------------------------------------------------------------------
%% Helper Methods
%% -----------------------------------------------------------------------------

\def\sod@thesodversion#1#2#3#4\@nil{%
    \bgroup{}v#1.#2.#3#4\egroup%
}
\def\thesodversion{%
    \edef\@tmp{\noexpand\sod@thesodversion\arabic{sodversion}\noexpand\@nil}%
    \@tmp%
}

%% -----------------------------------------------------------------------------
%% Commands and Environments
%% -----------------------------------------------------------------------------

\def\manArg#1{\T{\{#1\}}}
\def\optArg#1{\T{\itshape[#1]}}
\def\cmd#1{\lstkwfive{\textbackslash#1}}
\def\env#1{\lstkwthree{env@#1}}
\def\cmdref#1{\hyperref[mrk:#1]{\lstkwfive{\textbackslash#1}}\textsuperscript{\(\rightarrow\,\)p. \pageref{mrk:#1}}}
\def\envref#1{\hyperref[mrk:#1]{\lstkwthree{env@#1}}\textsuperscript{\(\rightarrow\,\)p. \pageref{mrk:#1}}}

\makeatletter
% #1: name of the present-sequence
% #2: Args of the present-sequence
% #3: presenter style
% #4: prefix of cs-name
\newenvironment{present}[4]{\phantomsection\label{mrk:#1}%
    \bgroup\leavevmode\newline\noindent\hspace*{-0.75cm}\parbox{0.75cm}{\(\triangleright\)\quad}{\@nameuse{#3}{#4#1}}{\T{#2}}\par\nopagebreak% done on purpose
}{\egroup\bigskip}
\makeatother

% #1: name of the command-sequence
% #2: Args of the command-sequence
\newenvironment{command}[2]{\present{#1}{#2}{lstkwfive}{\textbackslash}}{\endpresent}

% #1: name of the environment
% #2: Args of the environment
\newenvironment{environment}[2]{\present{#1}{#2}{lstkwthree}{env@}}{\endpresent}


% #1: name of the arg
% #2: name of the counter-Arg
\newenvironment{argument}[2]{\present{#1}{\qquad(\T{#2})}{T}{}}{\endpresent}


\endinput